steps:
- script: |
    set -e
    sudo rm -rf /var/cache/dnf/*
    sudo dnf -y makecache || :
    echo "Installing base development environment"
    sudo dnf install -y \
        gdb-minimal \
        make \
        autoconf \
        rpm-build \
        gettext-devel \
        automake \
        libtool \
        docker \
        python3-paramiko \
        python3-pyyaml \

    echo "Installing FreeIPA development dependencies"
    sudo dnf -y copr enable @389ds/389-ds-base-nightly
    sudo dnf builddep -y freeipa
    sudo dnf builddep -y --skip-broken -D "with_wheels 1" -D "with_lint 1" -D "with_doc 1" --spec freeipa.spec.in --best --allowerasing --setopt=install_weak_deps=False
  displayName: Prepare build environment
